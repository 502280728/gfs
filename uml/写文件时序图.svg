<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="614px" preserveAspectRatio="none" style="width:624px;height:614px;" version="1.1" viewBox="0 0 624 614" width="624px" zoomAndPan="magnify"><defs><filter height="300%" id="f1b2zx0z6buwlt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1b2zx0z6buwlt)" height="185.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="128.5" y="183.0938"/><rect fill="#FFFFFF" filter="url(#f1b2zx0z6buwlt)" height="113.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="69.4297"/><rect fill="#FFFFFF" filter="url(#f1b2zx0z6buwlt)" height="128.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="427.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="133" x2="133" y1="38.2969" y2="574.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="275.5" x2="275.5" y1="38.2969" y2="574.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="416" x2="416" y1="38.2969" y2="574.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="570" x2="570" y1="38.2969" y2="574.0859"/><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="106" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="113" y="22.9951">client</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="106" y="573.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="113" y="593.0811">client</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="224.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="231.5" y="22.9951">masternode</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="224.5" y="573.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="231.5" y="593.0811">masternode</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="370" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="377" y="22.9951">datanode1</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="370" y="573.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="377" y="593.0811">datanode1</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="524" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="531" y="22.9951">datanode2</text><rect fill="#FEFECE" filter="url(#f1b2zx0z6buwlt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="524" y="573.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="531" y="593.0811">datanode2</text><rect fill="#FFFFFF" filter="url(#f1b2zx0z6buwlt)" height="185.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="128.5" y="183.0938"/><rect fill="#FFFFFF" filter="url(#f1b2zx0z6buwlt)" height="113.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="69.4297"/><rect fill="#FFFFFF" filter="url(#f1b2zx0z6buwlt)" height="128.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="427.2891"/><polygon fill="#A80036" points="258.5,65.4297,268.5,69.4297,258.5,73.4297,262.5,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="133.5" x2="264.5" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="140.5" y="64.3638">请求写入某个文件</text><path d="M153,82.4297 L153,152.4297 L261,152.4297 L261,92.4297 L251,82.4297 L153,82.4297 " fill="#FBFB77" filter="url(#f1b2zx0z6buwlt)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M251,82.4297 L251,92.4297 L261,92.4297 L251,82.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="159" y="99.4966">随机选择一些</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="159" y="114.6294">datanode作为</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="159" y="129.7622">主要节点和备</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="159" y="144.895">份节点</text><polygon fill="#A80036" points="149.5,179.0938,139.5,183.0938,149.5,187.0938,145.5,183.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="143.5" x2="274.5" y1="183.0938" y2="183.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="155.5" y="178.0278">传回datanode地址</text><path d="M8,196.0938 L8,251.0938 L120,251.0938 L120,206.0938 L110,196.0938 L8,196.0938 " fill="#FBFB77" filter="url(#f1b2zx0z6buwlt)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M110,196.0938 L110,206.0938 L120,206.0938 L110,196.0938 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="14" y="213.1606">client会将文件</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="14" y="228.2935">分成固定大小传</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="14" y="243.4263">输</text><polygon fill="#A80036" points="404.5,277.625,414.5,281.625,404.5,285.625,408.5,281.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138.5" x2="410.5" y1="281.625" y2="281.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="145.5" y="276.5591">发送相应的数据段到目标datanode</text><polygon fill="#A80036" points="149.5,306.7578,139.5,310.7578,149.5,314.7578,145.5,310.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="143.5" x2="415.5" y1="310.7578" y2="310.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="155.5" y="305.6919">返回ACK</text><polygon fill="#A80036" points="558.5,335.8906,568.5,339.8906,558.5,343.8906,562.5,339.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138.5" x2="564.5" y1="339.8906" y2="339.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="145.5" y="334.8247">发送相应的数据段到目标datanode</text><polygon fill="#A80036" points="144.5,365.0234,134.5,369.0234,144.5,373.0234,140.5,369.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138.5" x2="569.5" y1="369.0234" y2="369.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="150.5" y="363.9575">返回ACK</text><polygon fill="#A80036" points="427.5,394.1563,417.5,398.1563,427.5,402.1563,423.5,398.1563" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="558.5,394.1563,568.5,398.1563,558.5,402.1563,562.5,398.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421.5" x2="564.5" y1="398.1563" y2="398.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="433.5" y="393.0903">根据备份设置发送备份</text><polygon fill="#A80036" points="291.5,423.2891,281.5,427.2891,291.5,431.2891,287.5,427.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285.5" x2="415.5" y1="427.2891" y2="427.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="297.5" y="422.2231">报告接收的文件情况</text><path d="M129,440.2891 L129,525.2891 L261,525.2891 L261,450.2891 L251,440.2891 L129,440.2891 " fill="#FBFB77" filter="url(#f1b2zx0z6buwlt)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M251,440.2891 L251,450.2891 L261,450.2891 L251,440.2891 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="135" y="457.356">收集文件信息，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="135" y="472.4888">直到收到一个文件</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="135" y="487.6216">所有block的信息，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="135" y="502.7544">才将该文件置为可</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="135" y="517.8872">见</text><polygon fill="#A80036" points="286.5,552.0859,276.5,556.0859,286.5,560.0859,282.5,556.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="569.5" y1="556.0859" y2="556.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="292.5" y="551.02">报告接收的文件情况</text><!--
@startuml
participant "client" as A
participant "masternode" as B
participant "datanode1" as C
participant "datanode2" as D

A->B:请求写入某个文件
activate B
note left of B
 随机选择一些
 datanode作为
 主要节点和备
 份节点
end note
B->A:传回datanode地址
deactivate B
activate A
note left of A
 client会将文件
 分成固定大小传
 输
end note
A->C:发送相应的数据段到目标datanode
C->A: 返回ACK

A->D:发送相应的数据段到目标datanode
D->A: 返回ACK
deactivate A
C<->D:根据备份设置发送备份
C->B:报告接收的文件情况
activate B
note left of B
 收集文件信息，
 直到收到一个文件
 所有block的信息，
 才将该文件置为可
 见
end note
D->B:报告接收的文件情况

deactivate B
@enduml

PlantUML version 1.2018.05beta1(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>